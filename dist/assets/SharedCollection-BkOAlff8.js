import{z as n,N as b,h as m,q as e,t as l}from"./index-8wLK5tP2.js";import{S as f,E as y}from"./share-2-Cprh77f_.js";import{A as j}from"./arrow-left-C7oXRNhN.js";import{C as v}from"./calendar-CVpwYZaz.js";import{E as N}from"./eye-MYrhNOcT.js";import{S as _}from"./star-C1wr8eot.js";class S{static generateShareToken(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}static async createSharedCollection(r,t,i,o){try{const{data:{session:s},error:d}=await n.auth.getSession();if(d||!(s!=null&&s.user))throw new Error("User not authenticated");const h=this.generateShareToken(),u=o?new Date(Date.now()+o*24*60*60*1e3).toISOString():null,{data:g,error:a}=await n.from("shared_collections").insert({project_id:r,project_name:t,share_token:h,user_id:s.user.id,products_data:i,expires_at:u,view_count:0}).select().single();if(a)throw console.error("Error creating shared collection:",a),new Error(`Failed to create shared collection: ${a.message}`);return{shareUrl:`${window.location.origin}/shared/${h}`,shareToken:h}}catch(s){throw console.error("Error in createSharedCollection:",s),new Error(s.message||"Failed to create shareable link")}}static async getSharedCollection(r){try{const{data:t,error:i}=await n.from("shared_collections").select("*").eq("share_token",r).single();if(i){if(i.code==="PGRST116")return null;throw console.error("Error fetching shared collection:",i),new Error(`Failed to fetch shared collection: ${i.message}`)}return t.expires_at&&new Date(t.expires_at)<new Date?null:(await n.from("shared_collections").update({view_count:t.view_count+1}).eq("share_token",r),{id:t.id,project_name:t.project_name,products:t.products_data||[],created_at:t.created_at,view_count:t.view_count+1})}catch(t){throw console.error("Error in getSharedCollection:",t),new Error(t.message||"Failed to fetch shared collection")}}static async getUserSharedCollections(){try{const{data:{session:r},error:t}=await n.auth.getSession();if(t||!(r!=null&&r.user))throw new Error("User not authenticated");const{data:i,error:o}=await n.from("shared_collections").select("*").eq("user_id",r.user.id).order("created_at",{ascending:!1});if(o)throw console.error("Error fetching user shared collections:",o),new Error(`Failed to fetch shared collections: ${o.message}`);return(i||[]).map(s=>({id:s.id,project_id:s.project_id,project_name:s.project_name,share_token:s.share_token,products:s.products_data||[],created_at:s.created_at,expires_at:s.expires_at,view_count:s.view_count}))}catch(r){throw console.error("Error in getUserSharedCollections:",r),new Error(r.message||"Failed to fetch shared collections")}}static async deleteSharedCollection(r){try{const{data:{session:t},error:i}=await n.auth.getSession();if(i||!(t!=null&&t.user))throw new Error("User not authenticated");const{error:o}=await n.from("shared_collections").delete().eq("share_token",r).eq("user_id",t.user.id);if(o)throw console.error("Error deleting shared collection:",o),new Error(`Failed to delete shared collection: ${o.message}`)}catch(t){throw console.error("Error in deleteSharedCollection:",t),new Error(t.message||"Failed to delete shared collection")}}static async copyToClipboard(r){try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(r);else{const t=document.createElement("textarea");t.value=r,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),t.remove()}}catch(t){throw console.error("Error copying to clipboard:",t),new Error("Failed to copy to clipboard")}}}const U=()=>{const{shareToken:x}=b(),[r,t]=m.useState(null),[i,o]=m.useState(!0),[s,d]=m.useState("");m.useEffect(()=>{x&&h(x)},[x]);const h=async a=>{try{o(!0),d("");const c=await S.getSharedCollection(a);if(!c){d("Collection not found or has expired");return}t(c)}catch(c){d(c.message||"Failed to load collection")}finally{o(!1)}},u=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),g=a=>a==="amazon"?"bg-orange-100 text-orange-700 border-orange-200":"bg-purple-100 text-purple-700 border-purple-200";return i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center",children:e.jsxs(l.div,{className:"text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"w-16 h-16 bg-white/80 backdrop-blur-xl border border-slate-200/60 rounded-2xl shadow-xl flex items-center justify-center mx-auto mb-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-violet-600 border-t-transparent rounded-full animate-spin"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Loading Collection..."}),e.jsx("p",{className:"text-slate-600",children:"Please wait while we fetch the shared collection"})]})}):s||!r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center",children:e.jsxs(l.div,{className:"text-center max-w-md mx-auto px-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Collection Not Found"}),e.jsx("p",{className:"text-slate-600 mb-6",children:s||"This collection may have been removed or the link has expired."}),e.jsxs(l.button,{onClick:()=>window.history.back(),className:"inline-flex items-center gap-2 px-6 py-3 bg-slate-900 text-white rounded-2xl hover:bg-slate-800 transition-all duration-300",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(j,{size:16}),"Go Back"]})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100",children:[e.jsxs(l.div,{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 text-white py-16 lg:py-20 relative overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"hero-dots",width:"60",height:"60",patternUnits:"userSpaceOnUse",children:e.jsx("circle",{cx:"30",cy:"30",r:"2",fill:"currentColor"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#hero-dots)",className:"text-white"})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 lg:px-8 relative z-10",children:e.jsxs(l.div,{className:"max-w-4xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:[e.jsx(l.div,{initial:{scaleX:0},animate:{scaleX:1},transition:{duration:1,delay:.3,ease:"easeOut"},className:"w-16 h-1 bg-gradient-to-r from-violet-400 to-blue-400 mb-6 rounded-full"}),e.jsxs(l.h1,{className:"font-light text-4xl md:text-5xl lg:text-6xl mb-6 leading-tight",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.8},children:[e.jsx("span",{className:"font-semibold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent",children:r.project_name}),e.jsx("span",{className:"block font-light text-2xl md:text-3xl lg:text-4xl mt-2 text-slate-300",children:"Shared Collection"})]}),e.jsxs(l.div,{className:"flex flex-wrap items-center gap-6 text-slate-300",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.8},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:16}),e.jsxs("span",{children:["Created ",u(r.created_at)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{size:16}),e.jsxs("span",{children:[r.view_count," views"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{size:16}),e.jsxs("span",{children:[r.products.length," products"]})]})]})]})})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 lg:px-8 py-20",children:[e.jsx(l.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},children:r.products.map((a,c)=>e.jsxs(l.div,{className:"bg-white/80 backdrop-blur-xl border border-slate-200/60 rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl hover:shadow-slate-900/5 transition-all duration-500 group",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:c*.1},whileHover:{y:-4,scale:1.01},children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.image,alt:a.title,className:"w-full h-64 object-cover transition-transform duration-700 group-hover:scale-105",onError:w=>{const p=w.target;p.src=`https://via.placeholder.com/400x400/f1f5f9/64748b?text=${encodeURIComponent(a.title.slice(0,20))}`}}),e.jsx("div",{className:`absolute top-4 left-4 px-3 py-1 border rounded-full text-xs font-medium capitalize ${g(a.source)}`,children:a.source}),e.jsx("div",{className:"absolute top-4 right-4 p-2 bg-white/90 backdrop-blur-sm border border-slate-200/60 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300",children:e.jsx(y,{size:14,className:"text-slate-600"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 text-lg mb-3 line-clamp-2",children:a.title}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex items-center text-yellow-500",children:Array.from({length:Math.round(a.rating)}).map((w,p)=>e.jsx(_,{size:14,className:"fill-current"},p))}),e.jsxs("span",{className:"text-sm text-slate-500 ml-2 font-medium",children:["(",a.reviewsCount.toLocaleString(),")"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-2xl text-slate-900",children:["$",a.price.toFixed(2)]}),e.jsxs(l.a,{href:a.url,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center gap-2 px-4 py-2 rounded-2xl font-medium transition-all duration-300 ${a.source==="amazon"?"bg-orange-600 hover:bg-orange-700 text-white":"bg-purple-600 hover:bg-purple-700 text-white"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("span",{children:"Shop Now"}),e.jsx(y,{size:14})]})]})]})]},a.id))}),e.jsx(l.div,{className:"mt-16 text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.6},children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl border border-slate-200/60 rounded-3xl p-8 shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-4",children:"About This Collection"}),e.jsx("p",{className:"text-slate-600 leading-relaxed max-w-2xl mx-auto",children:'This collection was curated using AI-powered design analysis. Each product has been carefully selected to match the design elements and style of the original inspiration. Click "Shop Now" to purchase any item directly from the retailer.'})]})})]})]})};export{U as default};
